<script type="text/javascript">
  RED.nodes.registerType("energyMeter", {
    category: "function",
    color: "#3FADB5",
    defaults: {
      name: { value: "" },
      topic: { value: "" },
      filepath: { value: "" },
      inputformat: { value: "w" },
      accuracy: { value: "100" },
      price: {
        value: "",
        validate: function (val) {
          return val > 1 || val === 0.0 || val === "";
        },
      },
    },
    inputs: 1,
    outputs: 1,
    icon: "power.png",
    oneditsave: function () {
      var node = this;
    },
    label: function () {
      return this.name || "energyMeter";
    },
  });
</script>

<script type="text/html" data-template-name="energyMeter">
  <div class="form-row">
    <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
    <input type="text" id="node-input-name" placeholder="Name" />
  </div>

  <div class="form-row">
    <label for="node-input-topic"><i class="fa fa-tag"></i> Topic</label>
    <input type="text" id="node-input-topic" placeholder="Topic" />
  </div>

  <div class="form-row">
    <div class="form-tips">
      <b>Info:</b> Use absolute file path, like
      /home/yourUser/.node-red/energy.json
    </div>
    <label for="node-input-filepath"
      ><i class="fa fa-file"></i> Filepath storage</label
    >
    <input
      type="text"
      id="node-input-filepath"
      placeholder="Leave empty to use contextStorage from settings.js"
    />
  </div>

  <div class="form-row">
    <label for="node-input-inputformat"
      ><i class="fa fa-arrow-right"></i> Input power format</label
    >
    <select id="node-input-inputformat">
      <option value="w">watt</option>
      <option value="kw">kw</option>
      <option value="mw">megawatt</option>
    </select>
  </div>

  <div class="form-row">
    <div class="form-tips">
      <b>Info:</b> Define the number of decimal places for energy calculation.
    </div>
    <label for="node-input-accuracy"
      ><i class="fa fa-terminal"></i> Decimal places</label
    >
    <select id="node-input-accuracy">
      <option value="1">0</option>
      <option value="10">1</option>
      <option value="100">2</option>
      <option value="1000">3</option>
    </select>
  </div>

  <div class="form-row">
    <label for="node-input-price"
      ><i class="fa fa-dollar"></i> Price ct/kwh</label
    >
    <input type="float" id="node-input-price" placeholder="ct/kwh" />
  </div>
</script>

<script type="text/html" data-help-name="energyMeter">
  <p>
    A node that calculates energy based on power inputs. It stores daily,
    weekly, monthly and yearly energy consumption/production.
  </p>
</script>
